AWSTemplateFormatVersion: '2010-09-09'
Description: >
  Alarms and dashboard
Parameters:
  bucketName:
    Type: String
    Description: The name of the S3 BucketName
  environment:
    Type: String
    Description: The environment name
  app:
    Type: String
    Description: App name used for tagging and naming
Resources:
  ConnectFunctionErrorAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: Connect Function Errors
      AlarmDescription: "Triggers if the ConnectFunction Lambda function has errors."
      Namespace: AWS/Lambda
      MetricName: Errors
      Dimensions:
        - Name: FunctionName
          Value: ConnectFunction
      Statistic: Sum
      Period: 900            # Evaluate every 15 minutes
      EvaluationPeriods: 48  # Evaluate over 12 hour window
      DatapointsToAlarm: 1   # Trigger if any single period breaches threshold
      Threshold: 0
      ComparisonOperator: GreaterThanThreshold
      TreatMissingData: notBreaching
  ConnectFunctionThrottleAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: Connect Function Throttles
      AlarmDescription: "Triggers if the ConnectFunction Lambda function throttles."
      Namespace: AWS/Lambda
      MetricName: Errors
      Dimensions:
        - Name: FunctionName
          Value: ConnectFunction
      Statistic: Sum
      Period: 900            # Evaluate every 15 minutes
      EvaluationPeriods: 48  # Evaluate over 12 hour window
      DatapointsToAlarm: 1   # Trigger if any single period breaches threshold
      Threshold: 0
      ComparisonOperator: GreaterThanThreshold
      TreatMissingData: notBreaching
  CheckFunctionErrorAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: Check Function Errors
      AlarmDescription: "Triggers if the CheckFunction Lambda function has errors."
      Namespace: AWS/Lambda
      MetricName: Errors
      Dimensions:
        - Name: FunctionName
          Value: CheckFunction
      Statistic: Sum
      Period: 900            # Evaluate every 15 minutes
      EvaluationPeriods: 48  # Evaluate over 12 hour window
      DatapointsToAlarm: 1   # Trigger if any single period breaches threshold
      Threshold: 0
      ComparisonOperator: GreaterThanThreshold
      TreatMissingData: notBreaching
  CheckFunctionThrottleAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: Check Function Throttles
      AlarmDescription: "Triggers if the CheckFunction Lambda function throttles."
      Namespace: AWS/Lambda
      MetricName: Errors
      Dimensions:
        - Name: FunctionName
          Value: CheckFunction
      Statistic: Sum
      Period: 900            # Evaluate every 15 minutes
      EvaluationPeriods: 48  # Evaluate over 12 hour window
      DatapointsToAlarm: 1   # Trigger if any single period breaches threshold
      Threshold: 0
      ComparisonOperator: GreaterThanThreshold
      TreatMissingData: notBreaching


#  LoneworkerDashboard:
#    Type: AWS::CloudWatch::Dashboard
#    Properties:
#      DashboardName: Lone worker dashboard
#      DashboardBody:

